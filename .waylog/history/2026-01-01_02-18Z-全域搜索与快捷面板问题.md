# 全域搜索与快捷面板问题
_Exported on 01/01/2026 at 10:29:55 GMT+8 from Cursor via WayLog_


**Cursor**

查看相关代码，定位 cursor 快捷操作的 listview 匹配问题。先查找相关实现：



查找 cursor 快捷操作面板的输入框和 listview 相关代码：



查看 cursor 快捷操作面板的搜索函数和全域搜索的匹配逻辑：



读取这两个函数的完整实现进行对比：



继续查看完整的函数实现，特别关注搜索匹配逻辑：



查找 SearchGlobalView 和 SearchAllDataSources 的实现：



查看 SearchGlobalView 的完整实现，了解其返回的数据结构：



对比两个函数的实现，确认问题。查看是否有全局变量访问的问题：



对比两个函数，发现关键问题：`DebouncedCursorPanelSearch` 中缺少对 `CursorPanelSearchEdit` 的全局变量声明。检查完整的函数实现：



问题：在 `DebouncedCursorPanelSearch` 中，对 `CursorPanelSearchEdit` 的全局变量声明方式可能存在问题。参考全域搜索的实现，对比两个函数使用全局变量的方式：



对比 `DebouncedSearchCenter` 和 `DebouncedCursorPanelSearch`，发现它们调用搜索函数的方式不同。修复 `DebouncedCursorPanelSearch`，使其采用与全域搜索相同的搜索逻辑：



参考全域搜索的实现，修复 `DebouncedCursorPanelSearch`：使用 `SearchAllDataSources` 而不是直接调用 `SearchGlobalView`，然后过滤出 prompt 类型的结果。



修正搜索逻辑：不限制搜索类型，搜索所有数据源，然后只过滤出 prompt 类型的结果，以与全域搜索的逻辑保持一致。



检查是否有语法错误：



已修复 cursor 快捷操作的 listview 匹配问题。主要修改如下：

## 修复说明

1. 搜索逻辑统一：将 `DebouncedCursorPanelSearch` 从直接调用 `SearchGlobalView` 改为使用 `SearchAllDataSources`，与全域搜索的实现保持一致。

2. 数据格式处理：`SearchAllDataSources` 返回 Map 格式（键为 DataType，值为包含 Items 数组的对象），修改了过滤逻辑以正确处理该格式。

3. 字段访问优化：统一时间显示和标题生成的逻辑，与 `DebouncedSearchCenter` 保持一致。

## 关键修改点

- 之前：直接调用 `SearchGlobalView`，然后手动过滤数组
- 现在：使用 `SearchAllDataSources`，从返回的 Map 中提取 "prompt" 类型的结果

这样可以确保 cursor 快捷操作面板的搜索逻辑与全域搜索一致，能够正确匹配并显示提示词模板数据。

---


**User**

.全域搜索的匹配逻辑
在全域搜索中心（SearchCenter）中，匹配逻辑是基于 SQLite 数据库查询 和 动态数组过滤 的：
入口熔断机制：代码中使用了 global_ST 句柄管理，在执行查询前会强制释放旧句柄 global_ST.Free()，防止数据库死锁 。
大小写不敏感搜索：SQL 语句中显式使用了 LOWER(Content) LIKE ? 配合 StrLower(Keyword) 进行匹配，确保了搜索的灵活性 。

2. 快捷操作面板的问题所在
在 测试.txt 的全局变量定义中：global CursorPanelResultLV := 0 ; 快捷操作面板搜索结果ListView（已废弃，保留以兼容） 。核心矛盾：你尝试在已废弃的控件中查找匹配数据。目前的架构已经转向了 独立的 ListView 窗口 GUI 对象（GuiID_CursorPanelListView）。

---


**Cursor**

检查相关代码，了解全域搜索的匹配逻辑和快捷操作面板的问题。



继续查找 SearchCenter 的匹配逻辑和快捷操作面板相关代码：



查找 SearchCenter 函数，查看匹配逻辑的实现：

---
